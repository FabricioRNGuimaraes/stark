<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" 
    "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">

<ui:composition template="/template.xhtml"
	xmlns="http://www.w3.org/1999/xhtml"
	xmlns:ui="http://java.sun.com/jsf/facelets"
	xmlns:h="http://java.sun.com/jsf/html"
	xmlns:f="http://java.sun.com/jsf/core"
	xmlns:p="http://primefaces.org/ui">

	<ui:define name="body">

		<p:panel id="userTable">
		 	<p:dataTable var="user" value="#{userBean.users}" rows="5"  
		 				 emptyMessage="There are no users" paginator="true" paginatorPosition="bottom" >  
	
		        <p:column filterBy="#{user.name}" filterMatchMode="contains" headerText="Name" sortBy="#{user.name}">  
		            <h:outputText value="#{user.name}" />  
		        </p:column>

		  		<p:column filterBy="#{user.email}" filterMatchMode="contains" headerText="e-mail" sortBy="#{user.email}" >  
		            <h:outputText value="#{user.email}" />  
		        </p:column>

		  		<p:column style="width:22%" headerText="Actions">
					
               		<p:commandButton oncomplete="visualizeDialog.show();" icon="visualizeIcon"
									 title="visualize" process="@this" update=":formGrid:panelGridDialog">
               			<f:setPropertyActionListener value="#{user}" target="#{userBean.user}" />
           			</p:commandButton>
           			
           			<p:commandButton update=":formGrid:mainPanel" icon="editIcon" actionListener="#{userBean.prepareEdit}" title="edit"
           							 process="@this" >
               			<f:setPropertyActionListener value="#{user}" target="#{userBean.user}" />
           			</p:commandButton>
           			
           			<p:commandButton title="remove" oncomplete="removeUser.show();" icon="removeIcon"
           							 process="@this" update=":formGrid:removeUser">
               			<f:setPropertyActionListener value="#{user}" target="#{userBean.user}" />
           			</p:commandButton>
       			</p:column>  
		  
		        <f:facet name="footer" >  
		            There are #{userBean.users.size()} users
		        </f:facet>  
			  
		    </p:dataTable>
		</p:panel>
	
		<p:panel id="mainPanel" header="User Data" >
  
			<p:panelGrid columns="2" styleClass="ui-panelGrid-stark" >
				<p:outputLabel for="name" value="User"  />
				<p:inputText id="name" value="#{userBean.user.name}" required="true"
							 requiredMessage="Name is required" styleClass="ui-inputText-stark" maxlength="50" />

				<p:outputLabel for="password" value="Password" />
				<p:password id="password" value="#{userBean.user.password}" required="true" redisplay="true"
							 requiredMessage="Password is required" maxlength="50" styleClass="ui-inputText-stark" />
							
				<p:outputLabel for="email" value="e-mail" />  
				<p:inputText id="email" value="#{userBean.user.email}" required="true"
							 requiredMessage="e-mail is required" validatorMessage="Invalid e-mail format" maxlength="50"
							 styleClass="ui-inputText-stark" >
							 <f:validateRegex pattern="^[_A-Za-z0-9-\+]+(\.[_A-Za-z0-9-]+)*@[A-Za-z0-9-]+(\.[A-Za-z0-9]+)*(\.[A-Za-z]{2,})$" />
				 </p:inputText>
                	 	 
			</p:panelGrid>
			
			<p:commandButton icon="saveIcon" actionListener="#{userBean.save}"
							 value="#{userBean.isEditEntity ? 'Update' : 'Save'}"
							 update="userTable :formGrid:growl :formGrid:mainPanel" oncomplete="cleanFields();"/>

			<p:commandButton icon="eraserIcon" value="#{userBean.isEditEntity ? 'Cancel' : 'Clean'}" 
							 oncomplete="cleanFields();" />
		</p:panel>

		<p:confirmDialog id="removeUser" widgetVar="removeUser" message="Remove #{userBean.user.name} ?" resizable="false"
				  		 appendToBody="true" header="Remove">

			<h:panelGrid columns="2">
				<p:commandButton value="No" oncomplete="removeUser.hide();" />

				<p:commandButton value="Yes" actionListener="#{userBean.remove}" process="@this" immediate="true"
					oncomplete="removeUser.hide(); cleanFields();" update="userTable :formGrid:growl :formGrid:mainPanel" />
			</h:panelGrid>
		</p:confirmDialog>

		<p:dialog modal="true" widgetVar="visualizeDialog" appendToBody="true" resizable="false" width="700"  >
			<h:panelGrid id="panelGridDialog" columns="2" cellpadding="5">  
               	<h:outputLabel for="dialogName" value="Username: " />  
               	<h:outputText id="dialogName" value="#{userBean.user.name}" />
               	
               	<h:outputLabel for="dialogEmail" value="Email: " />  
               	<h:outputText id="dialogEmail" value="#{userBean.user.email}" />
               	
            </h:panelGrid>
               <p:commandButton title="Close" icon="removeIcon" value="Close" onclick="visualizeDialog.hide()"/>
		</p:dialog>
		
		<p:remoteCommand name="cleanFields" actionListener="#{userBean.clean}" update="mainPanel" />
		<p:hotkey bind="esc" handler="visualizeDialog.hide(); removeUser.hide()" />
	</ui:define>
</ui:composition>