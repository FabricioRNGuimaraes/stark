<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" 
    "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">

<ui:composition template="/template.xhtml"
	xmlns="http://www.w3.org/1999/xhtml"
	xmlns:ui="http://java.sun.com/jsf/facelets"
	xmlns:h="http://java.sun.com/jsf/html"
	xmlns:f="http://java.sun.com/jsf/core"
	xmlns:p="http://primefaces.org/ui">

	<ui:define name="body">
		
		<p:panel>
			<p:schedule id="schedule" allDaySlot="false" view="agendaWeek" showWeekends="false" minTime="7" value="#{scheduleBean.scheduleModel}"
						maxTime="21" slotMinutes="60" >
				 <p:ajax event="dateSelect" listener="#{scheduleBean.onDateSelect}" oncomplete="eventDialog.show()" 
				 		 update="panelGridDialog" />
				 <p:ajax event="eventSelect"  listener="#{scheduleBean.onEventSelect}" oncomplete="eventDialog.show()" />
			</p:schedule>
		</p:panel>

		<p:dialog modal="true" widgetVar="eventDialog" appendToBody="true" resizable="false" width="700"
				  header="Date: #{scheduleModel.eventDate.day} - #{scheduleModel.classDate}  - #{scheduleModel.event.startDate}" id="eventDialog">

			<h:panelGrid id="panelGridDialog" columns="2">
       			
       			<h:outputLabel value="Class Date" />
       			<p:inputMask id="from" value="#{scheduleModel.event.startDate}" mask="99/99/9999">  
               		 <f:convertDateTime pattern="dd/MM/yyyy" />  
           		 </p:inputMask>  
       			<h:outputLabel value="Class Date" />
       			<h:inputText value="#{scheduleModel.event.startDate}" />
       			
       			<h:outputLabel value="Class Date" />
       			<p:calendar value="#{scheduleModel.event.startDate}" />
       			
       			
       			<h:outputLabel value="Class Room" />
       			<p:selectOneMenu id="oneMenuClassRooms" value="#{scheduleBean.classRoom}" >
					<f:selectItem itemLabel="Select a Class Room" />
					<f:selectItems value="#{scheduleBean.classRooms}" var="classRoom" itemLabel="#{classRoom.description}" 
								   itemValue="#{classRoom}" />
				</p:selectOneMenu>
       			
       			<h:outputLabel value="Course"  />
       			<p:selectOneMenu id="oneMenuCourses" value="#{scheduleBean.course}" converter="entityConverter" >
					<f:selectItem itemLabel="Select a Course" />
					<f:selectItems value="#{scheduleBean.courses}" var="course" itemLabel="#{course.description}" 
								   itemValue="#{course}" />
				    <p:ajax update=":formGrid:studentsPickList :formGrid:teachersPickList"
				    		event="change" process=":formGrid:oneMenuCourses"  
				    		listener="#{scheduleBean.onChangeOneMenuCourse}" />
				</p:selectOneMenu>
       			
      			<h:outputLabel value="Students"  />
               	<p:pickList id="studentsPickList" value="#{scheduleBean.studentsPickList}" var="student" itemLabel="#{student.name}" 
               				itemValue="#{student}" converter="entityConverter" showSourceControls="true" showTargetControls="true"
                   			showSourceFilter="true" showTargetFilter="true" filterMatchMode="contains">
       				 
       				 <f:facet name="sourceCaption">Available</f:facet>  
        			 <f:facet name="targetCaption">Selected</f:facet> 
        			 
        			 <p:column>
        			 	#{student.name}
        			 </p:column>
       			 </p:pickList>
       			 
       			<h:outputLabel value="Teachers"  />
               	<p:pickList id="teachersPickList" value="#{scheduleBean.teachersPickList}" var="teacher" itemLabel="#{teacher.name}" 
               				itemValue="#{teacher}" converter="entityConverter" showSourceControls="false" showTargetControls="false"  
                   			showSourceFilter="true" showTargetFilter="true" filterMatchMode="contains" >
       				 
       				 <f:facet name="sourceCaption">Available</f:facet>  
        			 <f:facet name="targetCaption">Selected</f:facet> 
        			 
        			 <p:column>
        			 	#{teacher.name}
        			 </p:column>
       			 </p:pickList>
			</h:panelGrid>	
    		
    		<p:commandButton title="Close" icon="removeIcon" value="Close" onclick="eventDialog.hide(); cleanFields();" />
      		<p:commandButton icon="saveIcon" actionListener="#{scheduleBean.save}" value="Save"
						 update=":formGrid:growl" oncomplete="eventDialog.hide(); remoteCommandSave()"/>
		</p:dialog>
		
		<p:hotkey bind="esc" handler="eventDialog.hide()" />
		<p:remoteCommand name="cleanFields" actionListener="#{scheduleBean.clean}" update="eventDialog" immediate="true" process="@this" />
		<p:remoteCommand name="remoteCommandSave" actionListener="#{scheduleBean.save}" update=":formGrid:growl" immediate="true" process="@this" />		
	</ui:define>
</ui:composition>